# راهنمای پیاده‌سازی قابلیت آفلاین در پروژه آرامستان

## وضعیت فعلی پروژه
- فریمورک: Next.js 16.1.5
- ساختار: App Router
- زبان: TypeScript
- استایل: Tailwind CSS
- زبان محتوا: فارسی (RTL)

## تغییرات اعمال شده

### 1. فایل manifest.json
- مسیر: `public/manifest.json`
- مشخصات PWA برای نصب اپلیکیشن روی دستگاه‌های موبایل
- شامل نام، توضیحات، آیکون‌ها و رنگ تم

### 2. صفحه آفلاین اختصاصی
- مسیر: `app/offline/page.tsx`
- طراحی زیبا و فارسی برای نمایش در صورت عدم دسترسی به اینترنت
- شامل دکمه تلاش مجدد و راهنمای کاربر

### 3. کامپوننت OfflineDetector
- مسیر: `app/components/OfflineDetector.tsx`
- تشخیص وضعیت اتصال به اینترنت
- نمایش نوتیفیکیشن در صورت قطع شدن اینترنت
- هدایت خودکار به صفحه آفلاین در صورت عدم دسترسی

### 4. Service Worker
- مسیر: `public/sw.js`
- کش کردن منابع اصلی برنامه
- ارائه محتوای کش شده در حالت آفلاین
- به‌روزرسانی دوره‌ای کش

### 5. کامپوننت ServiceWorkerRegistration
- مسیر: `app/components/ServiceWorkerRegistration.tsx`
- ثبت Service Worker در مرورگر
- بررسی دوره‌ای برای به‌روزرسانی‌ها

### 6. به‌روزرسانی layout.tsx
- افزودن متاتگ‌های لازم برای PWA
- افزودن کامپوننت‌های OfflineDetector و ServiceWorkerRegistration

## نحوه تست قابلیت آفلاین

### 1. تست در مرورگر کروم
1. باز کردن Developer Tools (F12)
2. رفتن به تب Network
3. تغییر وضعیت به Offline
4. رفرش صفحه یا رفتن به صفحات مختلف

### 2. تست در مرورگر فایرفاکس
1. باز کردن Developer Tools (F12)
2. رفتن به تب Network
3. کلیک روی آیکون Network settings
4. انتخاب گزینه Work Offline

### 3. تست در دستگاه موبایل
1. باز کردن برنامه در مرورگر موبایل
2. فعال کردن حالت پرواز (Airplane Mode)
3. باز کردن مجدد برنامه

## نکات مهم

### مدیریت کش
- فقط منابع اصلی کش شده‌اند تا حجم کش زیاد نشود
- درخواست‌های API کش نمی‌شوند تا از داده‌های قدیمی جلوگیری شود
- کش دوره‌ای به‌روزرسانی می‌شود

### تجربه کاربری
- در حالت آفلاین، نوتیفیکیشن مناسب به کاربر نمایش داده می‌شود
- صفحاتی که قبلاً باز شده‌اند در حالت آفلاین قابل مشاهده هستند
- دکمه تلاش مجدد برای اتصال مجدد به اینترنت

### محدودیت‌ها
- درخواست‌های API در حالت آفلاین کار نمی‌کنند
- صفحاتی که هنوز باز نشده‌اند در حالت آفلاین در دسترس نیستند
- برخی قابلیت‌های تعاملی ممکن است محدود شوند

## به‌روزرسانی‌های آتی

1. **استفاده از next-pwa**: برای پشتیبانی کامل‌تر از PWA
2. **کوشن استراتژی‌های پیشرفته**: برای مدیریت بهتر کش
3. **IndexedDB**: برای ذخیره داده‌های کاربر در حالت آفلاین
4. **Background Sync**: برای همگام‌سازی داده‌ها پس از اتصال مجدد

## عیب‌یابی

### مشکل: Service Worker ثبت نمی‌شود
- بررسی کنید که آیا پروژه روی HTTPS یا localhost اجرا می‌شود
- بررسی کنسول مرورگر برای خطاهای مربوط به Service Worker

### مشکل: محتوای آفلاین نمایش داده نمی‌شود
- بررسی کنید که آیا منابع مورد نظر در کش قرار گرفته‌اند
- بررسی تب Application در Developer Tools برای وضعیت Service Worker

### مشکل: صفحه آفلاین نمایش داده نمی‌شود
- بررسی مسیر صفحه آفلاین در Service Worker
- بررسی اینکه آیا صفحه آفلاین در کش قرار گرفته است